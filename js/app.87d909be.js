(function(e){function t(t){for(var r,n,a=t[0],c=t[1],d=t[2],h=0,p=[];h<a.length;h++)n=a[h],Object.prototype.hasOwnProperty.call(o,n)&&o[n]&&p.push(o[n][0]),o[n]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);l&&l(t);while(p.length)p.shift()();return s.push.apply(s,d||[]),i()}function i(){for(var e,t=0;t<s.length;t++){for(var i=s[t],r=!0,a=1;a<i.length;a++){var c=i[a];0!==o[c]&&(r=!1)}r&&(s.splice(t--,1),e=n(n.s=i[0]))}return e}var r={},o={app:0},s=[];function n(t){if(r[t])return r[t].exports;var i=r[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=r,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/blink-detector/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var d=0;d<a.length;d++)t(a[d]);var l=c;s.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("56d7")},"034f":function(e,t,i){"use strict";i("85ec")},1:function(e,t){},2:function(e,t){},3:function(e,t){},"56d7":function(e,t,i){"use strict";i.r(t);i("e260"),i("e6cf"),i("cca6"),i("a79d");var r=i("2b0e"),o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[i("blink-detector")],1)},s=[],n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[e.isIntro?[i("p",[e._v("При идентификации, посмотрите в камеру и моргните минимум 4 раза")]),i("p",[e._v("Избегайте попадания в кадр других людей и слишком тёмного фона.")]),i("button",{staticClass:"btn",on:{click:e.start}},[e._v(" Идентификация ")])]:e.showProgress&&!e.testInProgress?[i("p",[e._v(" Идентификация пройдена ")]),i("div",{staticClass:"preview"},[i("img",{staticClass:"preview__image",attrs:{src:e.resultPhoto,alt:"Фото для отправки"}})]),i("button",{staticClass:"btn",on:{click:e.restart}},[e._v(" Повторить идентификацию ")])]:[e.isVideoLoading?i("p",[e._v(" Загружаем видеопоток... ")]):e._e(),i("video",{ref:"videoSrc",staticClass:"webcam-video hidden",attrs:{width:e.videoWidth,height:e.videoHeight},on:{canplay:e.onSourceReady}},[e._v(" Ваш браузер не поддерживает функционал этой страницы ")])]],2)},a=[],c=(i("d093"),i("fa11")),d=(i("ee7d"),i("a492"));const l=.2,h=1;let p,u=0,f=0,v=null,g=null;var m={name:"BlinkDetector",data:()=>({isIntro:!0,testInProgress:!0,showProgress:!1,isVideoLoading:!0,videoWidth:0,videoHeight:0,resultPhoto:null}),async mounted(){await c["xd"]("webgl"),p||(p=await d["b"](d["a"].mediapipeFacemesh,{shouldLoadIrisModel:!0,maxFaces:1,iouThreshold:0,scoreThreshold:.9}));const e={video:!0,audio:!1,width:{min:480,ideal:720,max:1080},height:{min:480,ideal:720,max:1080},advanced:[{facingMode:"user",aspectRatio:.75}]};g=await navigator.mediaDevices.getUserMedia(e)},beforeDestroy(){this.stopCamera()},methods:{start(){this.isIntro=!1,this.startCamera()},startCamera(){this.$nextTick(()=>{const e=this.$refs.videoSrc;e.setAttribute("autoplay",""),e.setAttribute("muted",""),e.setAttribute("playsinline",""),e.srcObject=g,e.onloadedmetadata=()=>{e.play()}})},stopCamera(){g&&(cancelAnimationFrame(v),this.$refs.videoSrc.pause(),this.$refs.videoSrc.srcObject=null,g.getVideoTracks()[0].stop(),this.testInProgress=!1,this.isVideoLoading=!0)},restart(){this.stopCamera(),u=0,f=0,this.resultPhoto=null,this.showProgress=!1,this.testInProgress=!0,this.startCamera()},async onSourceReady(){this.videoWidth=this.$refs.videoSrc.videoWidth,this.videoHeight=this.$refs.videoSrc.videoHeight,await this.processVideo(),this.$refs.videoSrc.classList.remove("hidden"),this.isVideoLoading=!1},eyeAspectRatio(e){return(Math.abs(e.p2-e.p6)+Math.abs(e.p3-e.p5))/(2*Math.abs(e.p1-e.p4))},async processVideo(){if(!this.$refs.videoSrc)return void console.warn("Видеопоток не найден");const e=await p.estimateFaces({input:this.$refs.videoSrc,returnTensors:!1,flipHorizontal:!1,predictIrises:!0}),t=e[0]?e[0].faceInViewConfidence:0,i=e[0]?e[0].annotations:{};if(t>.9&&Object.keys(i).length>0){const e={p1:i.rightEyeLower0[8][0],p2:i.rightEyeUpper0[4][1],p3:i.rightEyeUpper0[3][1],p4:i.rightEyeLower0[0][0],p5:i.rightEyeLower0[3][1],p6:i.rightEyeLower0[4][1]},t={p1:i.leftEyeLower0[8][0],p2:i.leftEyeUpper0[4][1],p3:i.leftEyeUpper0[3][1],p4:i.leftEyeLower0[0][0],p5:i.leftEyeLower0[3][1],p6:i.leftEyeLower0[4][1]},r=this.eyeAspectRatio(e),o=this.eyeAspectRatio(t),s=(r+o)/2;if(s<l)u+=1;else{u>=h&&(f+=1),u=0;const e=f>=Math.floor(Math.random()*Math.floor(4));if(!this.resultPhoto&&e){const e=document.createElement("canvas");e.width=this.videoWidth,e.height=this.videoHeight;const t=e.getContext("2d");t.drawImage(this.$refs.videoSrc,0,0,this.videoWidth,this.videoHeight),this.resultPhoto=e.toDataURL("image/jpeg"),e.remove()}}}v=requestAnimationFrame(this.processVideo),f>=4&&(this.stopCamera(),this.showProgress=!0,navigator.vibrate([300,300,300]))}}},y=m,b=(i("c54e"),i("2877")),w=Object(b["a"])(y,n,a,!1,null,null,null),P=w.exports,_={name:"App",components:{BlinkDetector:P}},S=_,O=(i("034f"),Object(b["a"])(S,o,s,!1,null,null,null)),j=O.exports;r["a"].config.productionTip=!1,new r["a"]({render:e=>e(j)}).$mount("#app")},6562:function(e,t,i){},"85ec":function(e,t,i){},c54e:function(e,t,i){"use strict";i("6562")}});