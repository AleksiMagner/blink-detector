(function(e){function t(t){for(var r,a,n=t[0],c=t[1],d=t[2],p=0,u=[];p<n.length;p++)a=n[p],Object.prototype.hasOwnProperty.call(s,a)&&s[a]&&u.push(s[a][0]),s[a]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);l&&l(t);while(u.length)u.shift()();return o.push.apply(o,d||[]),i()}function i(){for(var e,t=0;t<o.length;t++){for(var i=o[t],r=!0,n=1;n<i.length;n++){var c=i[n];0!==s[c]&&(r=!1)}r&&(o.splice(t--,1),e=a(a.s=i[0]))}return e}var r={},s={app:0},o=[];function a(t){if(r[t])return r[t].exports;var i=r[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=e,a.c=r,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(i,r,function(t){return e[t]}.bind(null,r));return i},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/blink-detector/";var n=window["webpackJsonp"]=window["webpackJsonp"]||[],c=n.push.bind(n);n.push=t,n=n.slice();for(var d=0;d<n.length;d++)t(n[d]);var l=c;o.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("56d7")},"034f":function(e,t,i){"use strict";i("85ec")},1:function(e,t){},2:function(e,t){},3:function(e,t){},"56d7":function(e,t,i){"use strict";i.r(t);i("e260"),i("e6cf"),i("cca6"),i("a79d");var r=i("2b0e"),s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[i("blink-detector")],1)},o=[],a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[e.isIntro?[i("p",[e._v("При идентификации, посмотрите в камеру и моргните минимум 4 раза")]),i("p",[e._v("Избегайте попадания в кадр других людей.")]),i("button",{staticClass:"btn",on:{click:e.start}},[e._v(" Идентификация ")])]:e.testInProgress?[i("div",{staticClass:"webcam"},[i("video",{ref:"videoSrc",staticClass:"webcam-video",attrs:{width:e.videoWidth,height:e.videoHeight},on:{canplay:e.onSourceReady}},[e._v(" Ваш браузер не поддерживает функционал этой страницы ")]),i("canvas",{ref:"canvas",attrs:{width:e.videoWidth,height:e.videoHeight}})]),i("button",{staticClass:"btn",on:{click:e.restart}},[e._v(" Повторить идентификацию ")])]:[i("p",[e._v(" Идентификация пройдена ")]),i("div",{staticClass:"preview"},[i("img",{staticClass:"preview__image",attrs:{src:e.resultPhoto,alt:"Фото для отправки"}})]),i("button",{staticClass:"btn",on:{click:e.restart}},[e._v(" Повторить идентификацию ")])]],2)},n=[],c=(i("2b3d"),i("d093"),i("fa11")),d=(i("ee7d"),i("8b1d"),i("a492"));const l=.2;let p,u=0,h=null,v=null,f=null;var g={name:"BlinkDetector",data:()=>({isIntro:!0,testInProgress:!0,videoWidth:0,videoHeight:0,resultPhoto:null}),async mounted(){await c["zd"]("cpu")},beforeDestroy(){this.stopCamera()},methods:{start(){this.isIntro=!1,this.startCamera()},async startCamera(){void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=e=>{const t=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return t?new Promise((i,r)=>{t.call(navigator,e,i,r)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))});let e="";try{const t=await navigator.mediaDevices.enumerateDevices();t.forEach(t=>{"videoinput"===t.kind&&(e=t.deviceId)})}catch(i){console.error("Filed enumerate devices. "+i)}const t={video:!0,audio:!1,width:{min:480,ideal:720,max:1080},height:{min:480,ideal:720,max:1080},advanced:[{facingMode:"user",aspectRatio:.75,video:{deviceId:e}}]};try{f=await navigator.mediaDevices.getUserMedia(t);const e=this.$refs.videoSrc;e.setAttribute("autoplay",""),e.setAttribute("muted",""),e.setAttribute("playsinline",""),"srcObject"in e?e.srcObject=f:window.webkitURL?e.src=window.webkitURL.createObjectURL(f):e.src=window.URL.createObjectURL(f),e.onloadedmetadata=()=>{e.play()}}catch(i){console.error("Camera start error. "+i)}},stopCamera(){f&&(this.stopVideoProcessing(),this.$refs.videoSrc.pause(),this.$refs.videoSrc.srcObject=null,f.getVideoTracks()[0].stop(),f=null,this.testInProgress=!1)},restart(){this.stopCamera(),u=0,this.resultPhoto=null,this.testResult="",this.testInProgress=!0,this.startCamera()},async onSourceReady(){this.videoWidth=this.$refs.videoSrc.videoWidth,this.videoHeight=this.$refs.videoSrc.videoHeight,h=this.$refs.canvas.getContext("2d"),h.translate(this.videoWidth,0),h.scale(-1,1),p||(p=await d["b"](d["a"].mediapipeFacemesh,{shouldLoadIrisModel:!0,maxFaces:1,iouThreshold:0,scoreThreshold:.9})),v=requestAnimationFrame(this.processVideo)},eyeAspectRatio(e){return(Math.abs(e.p2-e.p6)+Math.abs(e.p3-e.p5))/(2*Math.abs(e.p1-e.p4))},async processVideo(){if(!this.$refs.videoSrc)return void console.warn("Видеопоток не найден");const e=await p.estimateFaces({input:this.$refs.videoSrc,returnTensors:!1,flipHorizontal:!1,predictIrises:!0}),t=e[0]?e[0].faceInViewConfidence:0,i=e[0]?e[0].annotations:{};if(h.drawImage(this.$refs.videoSrc,0,0,this.videoWidth,this.videoHeight),t>.9&&Object.keys(i).length>0){const e={p1:i.rightEyeLower0[8][0],p2:i.rightEyeUpper0[4][1],p3:i.rightEyeUpper0[3][1],p4:i.rightEyeLower0[0][0],p5:i.rightEyeLower0[3][1],p6:i.rightEyeLower0[4][1]},t={p1:i.leftEyeLower0[8][0],p2:i.leftEyeUpper0[4][1],p3:i.leftEyeUpper0[3][1],p4:i.leftEyeLower0[0][0],p5:i.leftEyeLower0[3][1],p6:i.leftEyeLower0[4][1]},r=this.eyeAspectRatio(e),s=this.eyeAspectRatio(t),o=(r+s)/2;o<l?u+=1:!this.resultPhoto&&l>1&&(h.drawImage(this.$refs.videoSrc,0,0),this.resultPhoto=this.$refs.canvas.toDataURL("image/jpeg"))}v=requestAnimationFrame(this.processVideo),u>=4&&(this.stopCamera(),navigator.vibrate([300,300,300]))},stopVideoProcessing(){cancelAnimationFrame(v),h.clearRect(0,0,this.videoWidth,this.videoHeight)}}},m=g,b=(i("c54e"),i("2877")),w=Object(b["a"])(m,a,n,!1,null,null,null),y=w.exports,P={name:"App",components:{BlinkDetector:y}},j=P,O=(i("034f"),Object(b["a"])(j,s,o,!1,null,null,null)),_=O.exports;r["a"].config.productionTip=!1,new r["a"]({render:e=>e(_)}).$mount("#app")},6562:function(e,t,i){},"85ec":function(e,t,i){},c54e:function(e,t,i){"use strict";i("6562")}});
//# sourceMappingURL=app.0bd0a411.js.map